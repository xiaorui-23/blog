---
title: å‰ç«¯å¼€å‘æœåŠ¡å™¨ä¸­çš„ Proxy ä»£ç†è·¨åŸŸå®ç°åŸç†è§£è¯»
cover: https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b99d66bda60a4ed2b723c92dbba34d68~tplv-k3u1fbpfcp-no-mark:480:480:0:0.awebp?
tags:
  - å‰ç«¯
  - JavaScript
categories: 
  - å‰ç«¯
  - JavaScript
date: 2023-02-01
description: åœ¨å‰ç«¯çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹ï¼Œè·¨åŸŸæ˜¯ä¸ªç»•ä¸å¼€çš„è¯é¢˜ï¼Œç›¸ä¿¡æ¯ä¸ªå‰ç«¯éƒ½ä¼šæ¶‰åŠåˆ°è¿™ä¸ªé—®é¢˜ï¼Œè®°ä½çš„å°±ç›´æ¥æ‰‹æ•²è§£å†³è·¨åŸŸé—®é¢˜ï¼Œè®°ä¸ä½çš„å°±åªèƒ½é—®åº¦å¨˜äº†ã€‚
---



å¼€å¯æ˜é‡‘æˆé•¿ä¹‹æ—…ï¼è¿™æ˜¯æˆ‘å‚ä¸ã€Œæ˜é‡‘æ—¥æ–°è®¡åˆ’ Â· 2 æœˆæ›´æ–‡æŒ‘æˆ˜ã€çš„ç¬¬ 1 å¤©ï¼Œ[ç‚¹å‡»æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…](https://juejin.cn/post/7194721470063312933 "https://juejin.cn/post/7194721470063312933")

å„ä½æœ‹å‹ä½ ä»¬å¥½ï¼Œæˆ‘æ˜¯[æ¡ƒå°ç‘](https://juejin.cn/user/1196739061361437)ã€‚åœ¨è¿™ç»™å¤§å®¶æ‹œä¸ªæ™šå¹´ï¼Œç¥å„ä½æœ‹å‹æ–°å¹´å¿«ä¹ã€‚

# å‰è¨€

åœ¨å‰ç«¯çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°¤å…¶æ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹ï¼Œè·¨åŸŸæ˜¯ä¸ªç»•ä¸å¼€çš„è¯é¢˜ï¼Œç›¸ä¿¡æ¯ä¸ªå‰ç«¯éƒ½ä¼šæ¶‰åŠåˆ°è¿™ä¸ªé—®é¢˜ï¼Œè®°ä½çš„å°±ç›´æ¥æ‰‹æ•²è§£å†³è·¨åŸŸé—®é¢˜ï¼Œè®°ä¸ä½çš„å°±åªèƒ½é—®åº¦å¨˜äº†ã€‚ğŸ˜‚ğŸ˜‚

å³å°†ç™»åœºçš„æ˜¯æˆ‘ä»¬çš„äºŒå·äººç‰©ï¼Œè·¨åŸŸã€‚ğŸ‘‡ğŸ‘‡ğŸ‘‡

# è·¨åŸŸ

## ä¸€ã€ä»€ä¹ˆæ˜¯è·¨åŸŸï¼Ÿ

è·¨åŸŸæ˜¯æŒ‡åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å­˜åœ¨çš„ä¸€ç§`èµ„æºåŒæºä¿æŠ¤ç­–ç•¥`ã€‚å½“é¡µé¢ä½¿ç”¨`ajax`/`fetch`è¿›è¡Œç½‘ç»œè¯·æ±‚æˆ–è€…é¡µé¢è¿›è¡Œèµ„æºè¯·æ±‚æ—¶ï¼Œ`ç½‘ç»œåè®®`ã€`åŸŸå`ã€`ç«¯å£`ä¸ä¸€è‡´æ—¶å°±ä¼šè§¦å‘æµè§ˆå™¨çš„`åŒæºç­–ç•¥ä¿æŠ¤`æœºåˆ¶ã€‚

æµè§ˆå™¨å°±ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºåƒä¸‹é¢å›¾ç‰‡ä¸­çš„å†…å®¹ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e5e22cc90bc48a787f71dafca10c3a9~tplv-k3u1fbpfcp-watermark.image?)

## äºŒã€è§£å†³è·¨åŸŸæœ‰å“ªäº›é€”å¾„å‘¢ï¼Ÿ

è§æ‹›æ‹†æ‹›ï¼Œæœ‰é™åˆ¶å°±æœ‰å¯¹ç­–ã€‚ç›®å‰æœ‰å¾ˆå¤šå¯ä»¥è§£å†³è·¨åŸŸçš„é—®é¢˜ï¼Œå„ä½çœ‹å®˜è¯·ç§»æ­¥å¾€ä¸‹çœ‹ğŸ‘‡ğŸ‘‡ğŸ‘‡

### å¸¸è§çš„è§£å†³è·¨åŸŸæ–¹å¼

#### 1ã€ JSONP

åˆ©ç”¨`script`æ ‡ç­¾æ²¡æœ‰è·¨åŸŸçš„é™åˆ¶ï¼Œä»è€Œå®ç°è·¨åŸŸã€‚

> æ³¨ï¼š`JSONP`ä»…æ”¯æŒ`get`è¯·æ±‚ï¼Œå¹¶ä¸”éœ€è¦åç«¯çš„æ”¯æŒã€‚

#### 2ã€ CORSï¼ˆ Cross-Origin Resource Sharing ï¼‰

åˆ©ç”¨ `CORS`å®ç°è·¨åŸŸï¼Œåç«¯åœ¨è¯·æ±‚çš„å“åº”è¯·æ±‚å¤´ä¸Šæ·»åŠ `Access-Control-Allow-Origin`å±æ€§ï¼Œå¹¶è®¾ç½®æŒ‡å®šçš„ç«™ç‚¹å€¼ï¼Œæˆ–è€…è®¾ç½®ä¸º`*`ã€‚

> æ³¨ï¼šéœ€è¦å‰åç«¯åŒæ—¶æ”¯æŒã€‚

#### 3ã€ nignx

`nignx åå‘ä»£ç†`

#### 4ã€websocket

åˆ©ç”¨`websocket`ï¼Œå®ç°æµè§ˆå™¨ä¸æœåŠ¡å™¨çš„å…¨åŒå·¥é€šä¿¡ï¼ŒåŒæ—¶å…è®¸è·¨åŸŸé€šè®¯ã€‚

#### 5ã€iframe

iframe æ­é… `document.domain`ã€`location.hash`ã€`window.name`ä¸‰ç§æ–¹å¼å®ç°è·¨åŸŸã€‚

#### 6ã€nodeä½œä¸ºä¸­é—´ä»¶ä»£ç†

å¯ç”¨ä¸€ä¸ªæœ¬åœ°çš„`node`æœåŠ¡å™¨å……å½“ä¸­é—´ä»¶ï¼Œè¿›è¡Œè·¨åŸŸå¤„ç†ã€‚

### å·¥ä½œä¸­å¸¸å¸¸ç”¨æ–¹å¼

åœ¨å·¥ä½œä¸­å¸¸è§çš„è·¨åŸŸä½¿ç”¨æ–¹å¼æœ‰`nignx åå‘ä»£ç†`ã€`CROS`ã€`node ä¸­é—´ä»£ç†`ã€‚

ä¸ºä»€ä¹ˆè¯´`node ä¸­é—´ä»£ç†`ä¹Ÿæ˜¯å¸¸ç”¨çš„æ–¹å¼å‘¢ï¼Ÿéƒ½æ²¡çœ‹è§ä½¿ç”¨è¿‡å‘€ã€‚æ¥æ¥æ¥ï¼Œæ­¤æ—¶æ­¤åˆ»å°±éœ€è¦æ¶‰åŠåˆ°æˆ‘ä»¬ä»Šå¤©çš„ä¸»äººå…¬äº†ã€‚

## ä¸‰ã€è·¨åŸŸç–‘é—®

### è·¨åŸŸçš„æ—¶å€™ï¼Œè¯·æ±‚æ˜¯å¦æ˜¯å‘å‡ºå»äº†çš„å‘¢ï¼Ÿæ•°æ®æˆ‘ä»¬æ˜¯å¦åˆæ”¶åˆ°äº†å‘¢ï¼Ÿ

ç­”æ¡ˆï¼š

è·¨åŸŸçš„æ—¶å€™ï¼Œè¯·æ±‚æ˜¯å·²ç»å‘å‡ºå»äº†ï¼Œè€Œä¸”åç«¯å·²ç»å°†æ•°æ®è¿”ç»™æˆ‘ä»¬äº†çš„ï¼Œåªæ˜¯è¢«æµè§ˆå™¨åŠ«æŒäº†ï¼Œæˆ‘ä»¬æ‹¿ä¸åˆ°è€Œå·²ã€‚

ç›¸ä¿¡ä½ çœ‹å®Œä¸‹é¢çš„æ¨¡æ‹Ÿå¯¹è¯å°±èƒ½æ‡‚äº†ã€‚

- å‰ç«¯ï¼šå‘é€è¯·æ±‚ç»™åç«¯ã€‚
- åç«¯ï¼šæ”¶åˆ°è¯·æ±‚ï¼Œæ•°æ®è¿”ç»™ä½ äº†ã€‚
- æµè§ˆå™¨ï¼šä½ åç«¯è¿™æ‰€åœ¨åœ°ï¼ˆ`æŒ‡ï¼šåè®®ã€åŸŸåã€ç«¯å£`ï¼‰å’Œæˆ‘æ‰€åœ¨åœ°ä¸å¯¹å‘€ï¼Œè‚¯å®šä¸å¯ä¿¡ï¼Œæ‹¦æˆªæ‰ï¼Œä¸ºäº†ä¸è®©å‰ç«¯äº‘é‡Œé›¾é‡Œçš„ï¼Œæˆ‘ç»™å®ƒæŠ¥ä¸ªå¼‚å¸¸å§ã€‚
- æˆ‘ä»¬çš„æ•°æ®å°±è¿™æ ·è¢«æµè§ˆå™¨æ‰€æ‹¦æˆªï¼Œä¸ç»™æˆ‘ä»¬äº†ã€‚
- ...


# node ä¸­é—´ä»£ç†

`node ä¸­é—´ä»£ç†` å®ƒè¿˜æœ‰å¦å¤–ä¸€ä¸ªåå­—ï¼Œå« `Proxy ä»£ç†è·¨åŸŸ`ã€‚ä¸»è§’é—ªäº®ç™»åœºã€‚ğŸ‘ğŸ‘

## ç®€å•ä½¿ç”¨

æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹å®ƒçš„å†™æ³•ï¼š

```javascript
server: {
    proxy: {
      '/api': {
        target: 'http://locahost:3000', // ç›®æ ‡åœ°å€
        changeOrigin: true, // æ˜¯å¦æ¢æºï¼Œ true æ¢æº
        rewrite: (path) => path.replace(/^\/api/, ''), // æ›¿æ¢
      }
    }
  }
```

### ç¯å¢ƒè¯´æ˜

æˆ‘è¿™é‡Œä½¿ç”¨çš„ç¯å¢ƒä¸ºï¼š
- vue
- vite

å…¶ä»–çš„è„šæ‰‹æ¶ç­‰åŸç†éƒ½å·®ä¸å¤šã€‚ç¯å¢ƒå¯¹æˆ‘ä»¬æ¥è¯´éƒ½ä¸æ˜¯äº‹ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æ‰’çš„æ˜¯å®ƒçš„åŸç†ã€‚

ç°åœ¨æˆ‘ä»¬æ­¥å…¥æ­£é¢˜ã€‚

## å¤ç°

æˆ‘ä»¬ç°åœ¨æ¥å¯åŠ¨æˆ‘ä»¬çš„é¡¹ç›®ã€‚

```javascript
pnpm run dev
```

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43c3b1279c23468b8258359747cfd407~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬å‘ç°ï¼Œvite ç»™æˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ªæœ¬åœ°çš„ node æœåŠ¡å™¨ï¼Œåœ°å€ä¸ºï¼šhttp://127.0.0.1:5173/ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2842a5d5d9484305a628290ea43f1878~tplv-k3u1fbpfcp-watermark.image?)

ç„¶åç°åœ¨æˆ‘ä»¬æ¥å‘ä¸ªè¯·æ±‚è¯•è¯•ã€‚

æˆ‘ä»¬å…ˆæŠŠ `vite.config.js`ä¸­çš„ä»£ç†å…³æ‰ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e6d553171ae648f78a32570a1aa6f69b~tplv-k3u1fbpfcp-watermark.image?)

æˆ‘ä»¬åœ¨`onMounted`ä¸­æ·»åŠ è¯·æ±‚ã€‚

```javascript
fetch('http://127.0.0.1:5888/api', {
    method: 'get'
})
```

æ­¤åˆ»æˆ‘ä»¬æ‰“å¼€æˆ‘ä»¬çš„æ§åˆ¶å°ï¼ŒæƒŠå–œæ¥äº†ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f1cdda15e01409fa3ee0effa2d30b65~tplv-k3u1fbpfcp-watermark.image?)

## å¼€å¯ä»£ç†

æˆ‘ä»¬ç°åœ¨æ”¾å¼€`vite.config.js`ä¸­çš„ä»£ç†æ³¨é‡Šã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b27ccbf1439d4809b62ae8b22a3fad11~tplv-k3u1fbpfcp-watermark.image?)

å†æ¥çœ‹çœ‹

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/69bee9fb0da540cc8eed02655c71152c~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f3b511878bc4b39b33c4ecb60815735~tplv-k3u1fbpfcp-watermark.image?)

## åŸç†è§£æ

åœ¨ vite å¯åŠ¨çš„æ—¶å€™ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå¼€å‘æœåŠ¡å™¨ï¼Œç„¶åæ ¹æ®æˆ‘ä»¬è¿›è¡Œçš„å¼€å‘æœåŠ¡å™¨é…ç½®è¿›è¡Œ node ä¸­é—´ä»¶ä»£ç†ã€‚vite æ ¹æ®é…ç½®å’Œæˆ‘ä»¬è¯·æ±‚çš„ api åœ°å€å»è¯·æ±‚å¯¹åº”çš„ apiåœ°å€ï¼Œæˆ‘ä»¬æ€ä¹ˆæŠŠå‚æ•°ç»™å®ƒçš„ï¼Œå®ƒå°±æ€ä¹ˆç»™ç›®æ ‡åœ°å€ï¼›ç„¶åç›®æ ‡åœ°å€æ€ä¹ˆç»™ vite çš„ï¼Œvite å°±åŸæ¨¡åŸæ ·çš„ç»™æˆ‘ä»¬ã€‚å¯èƒ½æˆ‘è¯´çš„æœ‰ç‚¹ç»•ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹ä¸€ä¸‹ä¸‹é¢çš„å›¾ã€‚

ä¸‹å›¾ä¸º node å¼€å‘æœåŠ¡ ä»£ç†è¯·æ±‚æµç¨‹å›¾ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b8fbec31b424b888e50426c1d492df7~tplv-k3u1fbpfcp-watermark.image?)

ä¸ºä»€ä¹ˆ node å°±å¯ä»¥è§£å†³è·¨åŸŸå‘¢ï¼Ÿ

å› ä¸º node ä¸æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨ä¸­çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æ²¡æœ‰è·¨åŸŸè¿™ç§é—®é¢˜ã€‚

# æ¸©é¦¨æé†’

è·¨åŸŸï¼Œä¹Ÿå°±æ˜¯åŒæºç­–ç•¥åªå­˜åœ¨äºæµè§ˆå™¨ç¯å¢ƒã€‚å¦‚ï¼šchromeã€ieã€æµè§ˆå™¨ã€webviewã€ä½¿ç”¨äº†æµè§ˆå™¨å†…æ ¸çš„ç¯å¢ƒã€‚åœ¨appã€å°ç¨‹åºç­‰å¹³å°ä¸­æ˜¯æ²¡æœ‰è¿™ä¸ªçš„ã€‚

# æ€»ç»“

ä»¥ä¸Šå°±æ˜¯`å‰ç«¯ Proxy ä»£ç†è·¨åŸŸå®ç°åŸç†è§£è¯»`çš„å…¨éƒ¨å†…å®¹ã€‚å¸Œæœ›æœ¬ç¯‡æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚

å¦‚æœ‰ä¸è¶³æˆ–ä½ æœ‰å…¶ä»–çš„è§è§£æ¬¢è¿ç•™åœ¨è¯„è®ºåŒºã€‚
