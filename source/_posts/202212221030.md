---
title: å‰ç«¯å®ç°é«˜äº®åˆ’è¯
cover: https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05b95e492c94408fbef7db69610b4803~tplv-k3u1fbpfcp-no-mark:480:480:0:0.awebp?
tags:
  - å‰ç«¯
  - JavaScript
  - Web Components
categories: 
  - å‰ç«¯
  - JavaScript
date: 2022-12-22
description: å‰è¨€ å‰ç«¯å®ç°æ–‡å­—é«˜äº®åˆ’è¯ã€‚è¿™ä¸ªåŠŸèƒ½ä¸€èˆ¬éƒ½æ˜¯ä¸€äº›ç±»ä¼¼ç¬”è®°äº§å“ä¸Šæ‰ä¼šå‡ºç°çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œé€šè¿‡æ·»åŠ æŒ‡å®šçš„å…³é”®å­—è¿›è¡Œé«˜äº®æ˜¾ç¤ºã€‚æˆ‘è¿™ä¸¤å¤©ä¹Ÿåšäº†ä¸€ä¸ªå‡ºæ¥ï¼Œåå­—å«ohlightï¼Œå®ç°çš„æ–¹å¼ä¸æ˜¯ç½‘ä¸Šé‚£äº›å¤æ‚çš„æ–¹å¼ï¼Œå¾ˆç®€
---



# å‰è¨€

å‰ç«¯å®ç°æ–‡å­—é«˜äº®åˆ’è¯ã€‚è¿™ä¸ªåŠŸèƒ½ä¸€èˆ¬éƒ½æ˜¯ä¸€äº›ç±»ä¼¼ç¬”è®°äº§å“ä¸Šæ‰ä¼šå‡ºç°çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œé€šè¿‡æ·»åŠ æŒ‡å®šçš„å…³é”®å­—è¿›è¡Œé«˜äº®æ˜¾ç¤ºã€‚æˆ‘è¿™ä¸¤å¤©ä¹Ÿåšäº†ä¸€ä¸ªå‡ºæ¥ï¼Œåå­—å«`ohlight`ï¼Œå®ç°çš„æ–¹å¼ä¸æ˜¯ç½‘ä¸Šé‚£äº›å¤æ‚çš„æ–¹å¼ï¼Œå¾ˆç®€å•çš„ä¸€ä¸ªæ–¹å¼ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹ä¸‹æ–¹åœ°å€ã€‚

# é¡¹ç›®åœ°å€

- gitee: [ç‚¹å‡»å‰å¾€](https://gitee.com/xiaoruil/o-light)
- github: [ç‚¹å‡»å‰å¾€](https://github.com/xiaoruil/o-light)
- npm: [ç‚¹å‡»å‰å¾€](https://www.npmjs.com/package/ohlight)

```js
// pnpm 
pnpm i ohlight

// npm
npm i ohlight

// yarn
yarn add ohlight
```


# ä½¿ç”¨æ•ˆæœ

æˆ‘ä»¬å…ˆçœ‹çœ‹ä»¥ä¸‹ä½¿ç”¨æ•ˆæœï¼Œé«˜äº®æ ·å¼æ˜¯å…¨åœºæ”¯æŒè‡ªå®šä¹‰çš„å“ˆï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„æ ·å¼ã€‚

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a5106e6d7a4c48a5b56739c4493cd94e~tplv-k3u1fbpfcp-watermark.image?)

# å®ç°

é‡‡ç”¨`web Components`å®ç°ç»„ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥è·¨æ¡†æ¶ã€æ— æ¡†æ¶è¿è¡Œäº†ï¼Œç®€ç›´é«˜æ•ˆä¸€å¥—ä»£ç è¿è¡Œä»»ä½•æ¡†æ¶ã€‚æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥çœ‹[MDN](https://developer.mozilla.org/zh-CN/docs/Web/Web_Components)ã€‚
é«˜äº®åˆ’è¯çš„åœ°æ–¹ä¹Ÿå¾ˆç®€å•ï¼Œä¸è¦çœ‹æ–‡ä»¶æœ‰ç‚¹å¤šï¼Œå®é™…éƒ½æ˜¯æ‰“è¾…åŠ©çš„ï¼Œæ ¸å¿ƒçš„å°±åªæœ‰ä¸‹é¢çš„ä»£ç ã€‚

```js
for(let keyword of keywords){
    c = c.replace(new RegExp(keyword, 'g'), `<mark style="${s}">${keyword}</mark>`)
}
```

ç°åœ¨æˆ‘ä»¬å¼€å§‹å®ç°è¿™ä¸ªç»„ä»¶å§ï¼Œæœ¬æ–‡å°†é‡‡ç”¨å’Œ`ohlight`ç»„ä»¶ä¸€æ ·çš„æ–¹å¼ã€‚

æœ¬ç¯‡æ–‡ç« æ˜¯åŸºäº`web Components`è¿›è¡Œç¼–å†™ï¼Œè¿˜ä¸äº†è§£çš„æœ‹å‹å¯ä»¥å»çœ‹ä¸€ä¸‹[MDN](https://developer.mozilla.org/zh-CN/docs/Web/Web_Components)ã€‚

æ³¨ï¼šæœ¬æ–‡ä¼šç®€å•å®ç°`ohlight`ç»„ä»¶çš„äº®è¯åŠŸèƒ½ï¼Œå…¶ä»–åŠŸèƒ½å¤§å®¶å¯ä»¥å»`gitee`å’Œ`github`ä¸Šçœ‹æºç ã€‚ğŸ‘æ¬¢è¿å¤§å®¶starã€issueç­‰ã€‚

## æ­å»ºåŸºç¡€æ¡†æ¶

æˆ‘ä»¬ç›´æ¥æ–°å»ºä¸€ä¸ª`OHLight`çš„ç±»ï¼Œç„¶åæ³¨å†Œï¼Œç»„ä»¶å†…éƒ¨è¿›è¡ŒæŒ‚è½½ã€‚è¿™é‡Œæˆ‘ä»¬å†™`OHLight`ç±»çš„æ—¶å€™éœ€è¦ç»§æ‰¿`HTMLElement`ã€‚

```js
class OHLight extends HTMLElement {}

customElements.define('o-hlight', OHLight)

export default OHLight
```

ç„¶ååœ¨`constructor`ä¸­éœ€è¦è°ƒç”¨`super()`ï¼Œè¿™ä¸€æ­¥å¿…ä¸å¯å°‘ã€‚

```js
constructor(){
    super()
}
```

æˆ‘ä»¬åœ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ª`renderer`æ¸²æŸ“å‡½æ•°ã€‚

```js
renderer () {}
```

æˆ‘ä»¬çš„åŸºç¡€æ¡†æ¶å°±æ­å»ºå¥½äº†ï¼Œä¸‹é¢æ˜¯ç›®å‰æ­¥éª¤çš„å®Œæ•´ä»£ç ï¼š

```js
class OHLight extends HTMLElement {
    constructor(){
        super()
    }

    renderer () {}
}

customElements.define('o-hlight', OHLight)

export default OHLight
```

## æ¸²æŸ“

è¿™ä¸€æ­¥æˆ‘ä»¬éœ€è¦å°†æˆ‘ä»¬çš„ç»„ä»¶æ¸²æŸ“åœ¨é¡µé¢ä¸Šã€‚è¿™ä¸€æ­¥çš„æ“ä½œå…¨ç¨‹éƒ½åœ¨`renderer`æ–¹æ³•ä¸­ã€‚

æˆ‘ä»¬å…ˆè®©æˆ‘ä»¬çš„ç»„ä»¶å¯ä»¥æ ¹æ®`dom`æ“ä½œè€Œæ“ä½œã€‚è¿™é‡Œå½“`mode`ä¸º`open`æ˜¯å¯ä»¥æ“ä½œçš„ï¼Œä¸º`closed`åˆ™è¯¥`dom`ä¸å¯æ“ä½œã€‚

```js
renderer () {
    this.attachShadow({
        mode: 'open'
    })
}
```

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`div`ç›’å­ç„¶åå¹¶æŒ‚è½½åˆ°æˆ‘ä»¬çš„`shadowRoot`å½±å­èŠ‚ç‚¹ä¸Šï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åˆ›å»ºå…¶ä»–çš„æ ‡ç­¾ï¼›å¹¶ç»™ä»–æ’å…¥å†…å®¹ï¼›ç„¶åæ·»åŠ ç»„ä»¶ã€‚

```js
const node = document.createElement('div')

node.innerHTML = 'æ¡ƒå°ç‘'

this.shadowRoot?.appendChild(node)
```
å¯ä»¥åœ¨`constructor`ä¸­è°ƒç”¨æˆ‘ä»¬çš„`renderer`æ–¹æ³•ã€‚

æ¥ä¸‹æ¥å°±åˆ°äº†å¥‡è¿¹çš„æ—¶åˆ»äº†ï¼Œæˆ‘ä»¬å¼•å…¥ç»„ä»¶ï¼Œå¹¶åœ¨é¡µé¢ä¸Šä½¿ç”¨ã€‚

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e409fb4ce512489ba13c7640f80b5a70~tplv-k3u1fbpfcp-watermark.image?)

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/065e6c3b11c84523bbd31029f63a4f9e~tplv-k3u1fbpfcp-watermark.image?)

æ­¤æ—¶çš„æ‰€æœ‰çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```js

class OHLight extends HTMLElement {
    constructor(){
        super()

        this.renderer()
    }
    renderer () {
        this.attachShadow({
            mode: 'open'
        })
        const node = document.createElement('div')
        node.innerHTML = 'æ¡ƒå°ç‘'
        this.shadowRoot?.appendChild(node)
    }
}

customElements.define('o-hlight', OHLight)
export default OHLight
```

é¡µé¢ä¸Šå°±ä¼šå‡ºç°æˆ‘ä»¬çš„ç»„ä»¶å†…å®¹ã€‚

## è·å–å±æ€§å¹¶è®¾ç½®é«˜äº®

è¿™ä¸€æ­¥æˆ‘ä»¬å°†è·å–æˆ‘ä»¬ä¼ é€’çš„æ–‡æœ¬å†…å®¹ã€å…³é”®è¯è¿›è¡Œé«˜äº®æ˜¾ç¤ºã€‚

æˆ‘ä»¬ä»¥`content`å±æ€§æ¥åšæˆ‘ä»¬çš„æ–‡æœ¬å†…å®¹ä¼ å‚ã€‚

æˆ‘ä»¬éœ€è¦è·å–æˆ‘ä»¬ç»„ä»¶ä¸­çš„`content`å±æ€§ã€‚å¹¶é€šè¿‡`innerHTML`å°†å†…å®¹æ’å…¥åˆ°é¡µé¢ä¸­å»

```js
let content = this.attributes.content
node.innerHTML = `${content.value}`
```

ç»„ä»¶å†…å®¹ï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58dd8afe4a314c83a375fb146551b3d5~tplv-k3u1fbpfcp-watermark.image?)

æ•ˆæœå›¾ï¼š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70a3170398f54196a83215c0dede26f5~tplv-k3u1fbpfcp-watermark.image?)

è¿™é‡Œæˆ‘ä»¬éœ€è¦å°†`constructor`ä¸­è°ƒç”¨`renderer`çš„æ–¹æ³•ç§»åŠ¨åˆ°`connectedCallback`ç”Ÿå‘½é’©å­å†…ï¼Œä¸ç„¶ä¼šæ‹¿ä¸åˆ°å†…å®¹ã€‚

```js
connectedCallback(){
    this.renderer()
}
```

é¡µé¢ä¸Šå·²ç»æ¸²æŸ“å‡ºæ¥äº†æˆ‘ä»¬çš„å†…å®¹ã€‚ç°åœ¨æˆ‘ä»¬è¿›è¡Œå…³é”®è¯è·å– + æ¸²æŸ“ã€‚

è·Ÿæˆ‘ä»¬è·å–å†…å®¹æ˜¯ä¸€æ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬è·å–`keywords`å…³é”®è¯åˆ—è¡¨ã€‚

```js
let keywords = this.attributes.keywords
```

ç°åœ¨æˆ‘ä»¬å·²ç»è·å–åˆ°äº†å…³é”®è¯åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯¹å†…å®¹è¿›è¡Œæ£€æŸ¥å’Œæ›¿æ¢ã€‚


å£°æ˜ä¸€ä¸ª`handle`çš„æ–¹æ³•ï¼Œå¹¶å°†æ–‡æœ¬å†…å®¹å’Œå…³é”®å­—ä¼ è¿›å»ï¼Œç”¨æ¥å¤„ç†æˆ‘ä»¬çš„é«˜äº®è¯æ±‡ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬å·²ç»å¤„ç†å¥½çš„æ–‡æœ¬å†…å®¹ï¼Œå¯ä»¥ç›´æ¥æ’å…¥æ˜¾ç¤ºã€‚


```js
node.innerHTML = this.handle((content.value || ''), (keywords.value || ''))
```

```js
handle (content, keywords) {
    let keywordList = []
    if(keywords.includes(',')){
        keywordList = keywords.split(',')
    }else{
        keywordList = [keywords]
    }

}
```

ä¸Šé¢æˆ‘ä»¬åœ¨`handle`æ–¹æ³•ä¸­è¿›è¡Œäº†å…³é”®è¯ç»„å¤„ç†ï¼Œå¤šä¸ªå…³é”®è¯ä½¿ç”¨`(,)é€—å·`éš”å¼€ï¼Œç„¶åè¿›è¡Œåˆ¤æ–­ã€åˆ‡å‰²ã€‚

```js
for(let keyword of keywordList){
            c = c.replace(new RegExp(keyword, 'g'), `<mark>${keyword}</mark>`)
}
```

è¿™é‡Œæˆ‘ä»¬å¯¹å·²ç»å¤„ç†å¥½çš„å…³é”®è¯è¿›è¡Œå¾ªç¯ï¼Œåœ¨å¾ªç¯çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬ä½¿ç”¨`new RegExp(keyword, 'g')`æ­£åˆ™è¿›è¡Œæ›¿æ¢ï¼Œå°†è·å–åˆ°çš„å…³é”®å­—æ›¿æ¢ä¸ºç”¨`mark`æ ‡ç­¾è£…èµ·æ¥çš„å­—ç¬¦ä¸²`<mark>${keyword}</mark>`ã€‚

çœ‹ä¸€ä¸‹æ•ˆæœï¼š

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c1b3e0d7773948e6a49917d6fbf5671f~tplv-k3u1fbpfcp-watermark.image?)

ç»„ä»¶å†…å®¹ï¼š

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/868611ff4cd442f5a494c3e6e80162dd~tplv-k3u1fbpfcp-watermark.image?)

è¿™æ ·æˆ‘ä»¬å°±å®ç°å¥½äº†ã€‚

### å®Œæ•´ä»£ç ï¼š
```js

class OHLight extends HTMLElement {
    constructor(){
        super()
    }

    renderer () {
        this.attachShadow({
            mode: 'open'
        })

        const node = document.createElement('div')
        
        let content = this.attributes.content
        let keywords = this.attributes.keywords

        node.innerHTML = this.handle((content.value || ''), (keywords.value || ''))

        this.shadowRoot?.appendChild(node)
    }

    handle (content, keywords) {
        let c = content
        let keywordList = []

        if(keywords.includes(',')){
            keywordList = keywords.split(',')
        }else{
            keywordList = [keywords]
        }
        
        for(let keyword of keywordList){
            c = c.replace(new RegExp(keyword, 'g'), `<mark>${keyword}</mark>`)
        }

        return c
    }

    // å½“è‡ªå®šä¹‰å…ƒç´ ç¬¬ä¸€æ¬¡è¢«è¿æ¥åˆ°æ–‡æ¡£ DOM æ—¶è¢«è°ƒç”¨
    connectedCallback(){
        this.renderer()
    }
}

customElements.define('o-hlight', OHLight)

export default OHLight
```


## ç”Ÿå‘½é’©å­è¯´æ˜è¡¥å……

`web components` æœ‰å››ä¸ªçŠ¶æ€çš„ç”Ÿå‘½é’©å­ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š

- `connectedCallback`ï¼šå½“è‡ªå®šä¹‰å…ƒç´ ç¬¬ä¸€æ¬¡è¢«è¿æ¥åˆ°æ–‡æ¡£ DOM æ—¶è¢«è°ƒç”¨ï¼›
- `disconnectedCallback`ï¼šå½“è‡ªå®šä¹‰å…ƒç´ ä¸æ–‡æ¡£ DOM æ–­å¼€è¿æ¥æ—¶è¢«è°ƒç”¨ï¼›
- `adoptedCallback`ï¼šå½“è‡ªå®šä¹‰å…ƒç´ è¢«ç§»åŠ¨åˆ°æ–°æ–‡æ¡£æ—¶è¢«è°ƒç”¨ï¼›
- `attributeChangedCallback`ï¼šå½“è‡ªå®šä¹‰å…ƒç´ çš„ä¸€ä¸ªå±æ€§è¢«å¢åŠ ã€ç§»é™¤æˆ–æ›´æ”¹æ—¶è¢«è°ƒç”¨ã€‚

æˆ‘ä»¬æƒ³å®ç°è‡ªå®šä¹‰æ ·å¼çš„è¯ç›´æ¥ç»™`mark`æ ‡ç­¾æ·»åŠ æ ·å¼å°±å¯ä»¥äº†ã€‚

å…³äºå“åº”å¼çš„é—®é¢˜ï¼Œ`ohlight`æ˜¯æ”¯æŒå“åº”å¼çš„ä¿®æ”¹å†…å®¹/å…³é”®å­—çš„ï¼Œè¿™é‡Œæˆ‘æ˜¯ä½¿ç”¨çš„`attributeChangedCallback`è¿›è¡Œç›‘å¬ã€‚

# æœ€å

ä»¥ä¸Šå°±æ˜¯å‰ç«¯å®ç°é«˜äº®åˆ’è¯çš„ä¸€ä¸ªæ–‡ç« ã€‚

æ¬¢è¿å¤§å®¶ä¸‹è½½ä½¿ç”¨[`ohlight é«˜äº®åˆ’è¯ç»„ä»¶`](https://www.npmjs.com/package/ohlight)ã€‚